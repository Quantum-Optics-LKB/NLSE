
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../nlse_tutorial/">
      
      
        <link rel="next" href="../reference/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>How to ? - NLSE Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NLSE Documentation" class="md-header__button md-logo" aria-label="NLSE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NLSE Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to ?
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NLSE Documentation" class="md-nav__button md-logo" aria-label="NLSE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NLSE Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure_and_inheritance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structure and Inheritance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../physics_problem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is the Physics problem ?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nlse_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLSE for the gifted amateur
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How to
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            How to
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    How to ?
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    How to ?
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmarking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-other-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with other projects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLSE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cnlse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coupled NLSE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kernels
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmarking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-other-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with other projects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="how-to">How to</h1>
<h2 id="benchmarking">Benchmarking</h2>
<p>If you want to benchmark the performance of the code you could use the function <a href="../examples/benchmarks.py"><code>examples/benchmarks.py</code></a> which is a simple script that runs the code multiple times and calculates the average time taken to run the code.</p>
<h2 id="comparison-with-other-projects">Comparison with other projects</h2>
<p>Compared to other related software like <a href="https://github.com/AshtonSBradley/FourierGPE.jl/tree/master"><code>FourierGPE.jl</code></a>, <code>NLSE</code> is much faster as it uses a much simpler solver (the latter uses the awesome <a href="https://docs.sciml.ai/DiffEqDocs/stable/"><code>DifferentialEquations.jl</code></a>).</p>
<p>Of course this gives you less control over the numerical accuracy of your model, however we think it's worth it since performance often limits the possible physical scenarii.</p>
<p>A comparison between the two projects can be found in <a href="../examples/comparison_juliaGPE.py"><code>comparison_juliaGPE.py</code></a> in our examples.</p>
<h2 id="testing">Testing</h2>
<p>The tests have been written to work in tandem with <a href="https://docs.pytest.org/en/8.2.x/"><code>pytest</code></a> and are run on each repository push using a GitHub action.</p>
<p>These tests essentially check for the physical definitions of all the class methods.</p>
<p>Here is an example of such a test file:</p>
<pre><code class="language-python">from NLSE import NLSE
import numpy as np
import pyfftw
from scipy.constants import c, epsilon_0

if NLSE.__CUPY_AVAILABLE__:
    import cupy as cp
    from pyvkfft.cuda import VkFFTApp as VkFFTApp_cuda
if NLSE.__PYOPENCL_AVAILABLE__:
    import pyopencl.array as cla
    from pyvkfft.opencl import VkFFTApp as VkFFTApp_cl
PRECISION_COMPLEX = np.complex64
PRECISION_REAL = np.float32


N = 2048
n2 = -1.6e-9
waist = 2.23e-3
waist2 = 70e-6
window = 4 * waist
power = 1.05
Isat = 10e4  # saturation intensity in W/m^2
L = 10e-3
alpha = 20


def test_build_propagator() -&gt; None:
    for backend in [&quot;CPU&quot;, &quot;GPU&quot;]:
        simu = NLSE(
            alpha, power, window, n2, None, L, NX=N, NY=N, Isat=Isat, backend=backend
        )
        prop = simu._build_propagator()
        assert np.allclose(
            prop,
            np.exp(-1j * 0.5 * (simu.Kxx**2 + simu.Kyy**2) / simu.k * simu.delta_z),
        ), f&quot;Propagator is wrong. (Backend {backend})&quot;


def test_build_fft_plan() -&gt; None:
    for backend in [&quot;CPU&quot;, &quot;GPU&quot;]:
        simu = NLSE(
            alpha, power, window, n2, None, L, NX=N, NY=N, Isat=Isat, backend=backend
        )
        if backend == &quot;CPU&quot; or backend == &quot;CL&quot;:
            A = np.random.random((N, N)) + 1j * np.random.random((N, N))
        elif backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            A = cp.random.random((N, N)) + 1j * cp.random.random((N, N))
        A = A.astype(PRECISION_COMPLEX)
        plans = simu._build_fft_plan(A)
        if backend == &quot;CPU&quot;:
            assert len(plans) == 2, f&quot;Number of plans is wrong. (Backend {backend})&quot;
            assert isinstance(
                plans[0], pyfftw.FFTW
            ), f&quot;Plan type is wrong. (Backend {backend})&quot;
            assert plans[0].output_shape == (
                N,
                N,
            ), f&quot;Plan shape is wrong. (Backend {backend})&quot;
        elif backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            assert len(plans) == 1, f&quot;Number of plans is wrong. (Backend {backend})&quot;
            assert isinstance(
                plans[0], VkFFTApp_cuda
            ), f&quot;Plan type is wrong. (Backend {backend})&quot;
            assert plans[0].shape0 == (
                N,
                N,
            ), f&quot;Plan shape is wrong. (Backend {backend})&quot;
        elif backend == &quot;CL&quot; and NLSE.__PYOPENCL_AVAILABLE__:
            assert len(plans) == 1, f&quot;Number of plans is wrong. (Backend {backend})&quot;
            assert isinstance(
                plans[0], VkFFTApp_cl
            ), f&quot;Plan type is wrong. (Backend {backend})&quot;
            assert plans[0].shape0 == (
                N,
                N,
            ), f&quot;Plan shape is wrong. (Backend {backend})&quot;


def test_prepare_output_array() -&gt; None:
    for backend in [&quot;CPU&quot;, &quot;GPU&quot;]:
        simu = NLSE(
            alpha, power, window, n2, None, L, NX=N, NY=N, Isat=Isat, backend=backend
        )
        if backend == &quot;CPU&quot; or backend == &quot;CL&quot;:
            A = np.random.random((N, N)) + 1j * np.random.random((N, N))
        elif backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            A = cp.random.random((N, N)) + 1j * cp.random.random((N, N))
        A = A.astype(PRECISION_COMPLEX)
        out, out_sq = simu._prepare_output_array(A, normalize=True)
        assert (
            out.flags.c_contiguous
        ), f&quot;Output array is not C-contiguous. (Backend {backend})&quot;
        assert (
            out_sq.flags.c_contiguous
        ), f&quot;Output array is not C-contiguous. (Backend {backend})&quot;
        if backend == &quot;CPU&quot;:
            assert (
                out.flags.aligned
            ), f&quot;Output array is not aligned. (Backend {backend})&quot;
            assert (
                out_sq.flags.aligned
            ), f&quot;Output array is not aligned. (Backend {backend})&quot;
        if simu.backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__ or simu.backend == &quot;CPU&quot;:
            integral = (
                (out.real * out.real + out.imag * out.imag)
                * simu.delta_X
                * simu.delta_Y
            ).sum(axis=simu._last_axes)
        if backend == &quot;CL&quot; and NLSE.__PYOPENCL_AVAILABLE__:
            arr = out.real * out.real + out.imag * out.imag
            arr *= simu.delta_X * simu.delta_Y
            integral = cla.sum(
                arr,
                dtype=arr.dtype,
                queue=simu._cl_queue,
            )
            integral = integral.get()
        integral *= c * epsilon_0 / 2
        assert np.allclose(
            integral, simu.power
        ), f&quot;Normalization failed. (Backend {simu.backend}) : {integral} != {simu.power}&quot;
        assert out.shape == (N, N), f&quot;Output array has wrong shape. (Backend {backend})&quot;
        if backend == &quot;CPU&quot;:
            assert isinstance(
                out, np.ndarray
            ), f&quot;Output array type does not match backend. (Backend {backend})&quot;
            out /= np.max(np.abs(out))
            A /= np.max(np.abs(A))
            assert np.allclose(
                out, A
            ), f&quot;Output array does not match input array. (Backend {backend})&quot;
        elif backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            assert isinstance(
                out, cp.ndarray
            ), f&quot;Output array type does not match backend. (Backend {backend})&quot;
            out /= cp.max(cp.abs(out))
            A /= cp.max(cp.abs(A))
            assert cp.allclose(
                out, A
            ), f&quot;Output array does not match input array. (Backend {backend})&quot;


def test_send_arrays_to_gpu() -&gt; None:
    if NLSE.__CUPY_AVAILABLE__:
        alpha = 20
        Isat = 10e4
        n2 = -1.6e-9
        V = np.random.random((N, N)) + 1j * np.random.random((N, N))
        alpha = np.repeat(alpha, 2)
        alpha = alpha[..., cp.newaxis, cp.newaxis]
        n2 = np.repeat(n2, 2)
        n2 = n2[..., cp.newaxis, cp.newaxis]
        Isat = np.repeat(Isat, 2)
        Isat = Isat[..., cp.newaxis, cp.newaxis]
        simu = NLSE(
            alpha, power, window, n2, V, L, NX=N, NY=N, Isat=Isat, backend=&quot;GPU&quot;
        )
        simu.propagator = simu._build_propagator()
        simu._send_arrays_to_gpu()
        assert isinstance(
            simu.propagator, cp.ndarray
        ), &quot;propagator is not a cp.ndarray. (Backend GPU)&quot;
        assert isinstance(simu.V, cp.ndarray), &quot;V is not a cp.ndarray. (Backend GPU)&quot;
        assert isinstance(
            simu.alpha, cp.ndarray
        ), &quot;alpha is not a cp.ndarray. (Backend GPU)&quot;
        assert isinstance(simu.n2, cp.ndarray), &quot;n2 is not a cp.ndarray. (Backend GPU)&quot;
        assert isinstance(
            simu.I_sat, cp.ndarray
        ), &quot;I_sat is not a cp.ndarray. (Backend GPU)&quot;
    else:
        pass


def test_retrieve_arrays_from_gpu() -&gt; None:
    if NLSE.__CUPY_AVAILABLE__:
        alpha = 20
        Isat = 10e4
        n2 = -1.6e-9
        V = np.random.random((N, N)) + 1j * np.random.random((N, N))
        alpha = np.repeat(alpha, 2)
        alpha = alpha[..., cp.newaxis, cp.newaxis]
        n2 = np.repeat(n2, 2)
        n2 = n2[..., cp.newaxis, cp.newaxis]
        Isat = np.repeat(Isat, 2)
        Isat = Isat[..., cp.newaxis, cp.newaxis]
        simu = NLSE(
            alpha, power, window, n2, V, L, NX=N, NY=N, Isat=Isat, backend=&quot;GPU&quot;
        )
        simu.propagator = simu._build_propagator()
        simu._send_arrays_to_gpu()
        simu._retrieve_arrays_from_gpu()
        assert isinstance(
            simu.propagator, np.ndarray
        ), &quot;propagator is not a np.ndarray. (Backend GPU)&quot;
        assert isinstance(simu.V, np.ndarray), &quot;V is not a np.ndarray. (Backend GPU)&quot;
        assert isinstance(
            simu.alpha, np.ndarray
        ), &quot;alpha is not a np.ndarray. (Backend GPU)&quot;
        assert isinstance(simu.n2, np.ndarray), &quot;n2 is not a np.ndarray. (Backend GPU)&quot;
        assert isinstance(
            simu.I_sat, np.ndarray
        ), &quot;I_sat is not a np.ndarray. (Backend GPU)&quot;
    else:
        pass


def test_split_step() -&gt; None:
    for backend in [&quot;CPU&quot;, &quot;GPU&quot;]:
        simu = NLSE(
            alpha, power, window, n2, None, L, NX=N, NY=N, Isat=Isat, backend=backend
        )
        simu.delta_z = 0
        simu.propagator = simu._build_propagator()
        E = np.ones((N, N), dtype=PRECISION_COMPLEX)
        A, A_sq = simu._prepare_output_array(E, normalize=False)
        simu.plans = simu._build_fft_plan(A)
        simu.propagator = simu._build_propagator()
        if backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            E = cp.asarray(E)
        if (
            backend == &quot;GPU&quot;
            and NLSE.__CUPY_AVAILABLE__
            or backend == &quot;CL&quot;
            and NLSE.__PYOPENCL_AVAILABLE__
        ):
            simu._send_arrays_to_gpu()
        simu.split_step(
            A, A_sq, simu.V, simu.propagator, simu.plans, precision=&quot;double&quot;
        )
        if backend == &quot;CPU&quot;:
            assert np.allclose(
                A, np.ones((N, N), dtype=PRECISION_COMPLEX)
            ), f&quot;Split step is not unitary. (Backend {backend})&quot;
        elif backend == &quot;GPU&quot; and NLSE.__CUPY_AVAILABLE__:
            assert cp.allclose(
                A, cp.ones((N, N), dtype=PRECISION_COMPLEX)
            ), f&quot;Split step is not unitary. (Backend {backend})&quot;


# tests for convergence of the solver : the norm of the field should be conserved
def test_out_field() -&gt; None:
    E = np.ones((N, N), dtype=PRECISION_COMPLEX)
    for backend in [&quot;CPU&quot;, &quot;GPU&quot;]:
        simu = NLSE(
            0, power, window, n2, None, L, NX=N, NY=N, Isat=Isat, backend=backend
        )
        E = simu.out_field(E, L, verbose=False, plot=False, precision=&quot;single&quot;)
        norm = np.sum(np.abs(E) ** 2 * simu.delta_X * simu.delta_Y)
        norm *= c * epsilon_0 / 2
        assert E.shape == (N, N), f&quot;Output array has wrong shape. (Backend {backend})&quot;
        assert np.allclose(
            norm, simu.power, rtol=1e-4
        ), f&quot;Norm not conserved. (Backend {backend})&quot;
</code></pre>
<h2 id="examples">Examples</h2>
<p>Minimum working examples for each class can be found in the <a href="../examples">examples</a> folder of the repo, as well as the code needed to benchmark performance on your machine and comparisons with other NLSE/GPE solvers.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>